<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.udesk.mapper.UserMapper">
	<!-- 插入用户数据 -->
	<!-- Integer insert(User user) -->
    <insert id="insert" parameterType="com.udesk.entity.User" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO t_user (
        id,
        username,
        password,
        email,
        phone,
        gender,
        avatar,
        status,
        is_delete,
        created_user,
        created_time,
        modified_user,
        modified_time,
        salt
    ) VALUES (
        #{id},
        #{username},
        #{password},
        #{email},
        #{phone},
        #{gender},
        #{avatar},
        #{status},
        #{isDelete},
        #{createdUser},
        #{createdTime},
        #{modifiedUser},
        #{modifiedTime},
        #{salt}
    )
    </insert>

    <!-- 根据用户名查询用户数据 -->
	<!-- User getUserByUsername(String username) -->
	<select id="getUserByUsername"
	    resultType="com.udesk.entity.User">
	    SELECT 
	        id,
	        username,
	        password,
	        email,
	        phone,
	        gender,
	        avatar,
	        status,
	        is_delete AS isDelete,
	        salt
	    FROM 
	        t_user 
	    WHERE 
	        username=#{username}
	</select>
	
	<!-- 根据用户id查询用户数据 -->
	<!-- User getUserById(Integer uid) -->
	<select id="getUserById"
		resultType="cn.udesk.entity.User">
		SELECT 
			id,
			username,
			password,
			email,
			phone,
			gender,
			avatar,
			salt,
			status,
			is_delete AS isDelete
		FROM 
			t_user 
		WHERE 
			id=#{uid}
	</select>
	
	<!-- 修改密码 -->
	<!-- Integer changePassword(
		    @Param("uid") Integer uid, 
		    @Param("password") String password) -->
	<update id="changePassword">
		UPDATE 
			t_user 
		SET 
			password=#{password}
		WHERE 
			id=#{uid}
	</update>
	
	<!-- 修改个人信息，包括：用户名、性别、头像、电话、邮箱 -->
	<!-- Integer changeInfo(User user) -->
	<update id="changeInfo">
		UPDATE 
			t_user 
		SET 
			<if test="username != null">
			usernaem = #{username},
			</if>>
			
			<if test="gender != null">
			gender=#{gender},
			</if>
			
			<if test="avatar != null">
			avatar=#{avatar},
			</if>
			
			<if test="phone != null">
			phone=#{phone},
			</if>
			
			<if test="email != null">
			email=#{email},
			</if>
			
			modified_user=#{modifiedUser},
			modified_time=#{modifiedTime}
		WHERE 
			id=#{id}
	</update>

</mapper>